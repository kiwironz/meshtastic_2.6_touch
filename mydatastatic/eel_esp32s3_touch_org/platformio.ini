; ===========================================
; EEL ESP32-S3 Touch Board Configuration for Meshtastic 2.6.11
; ===========================================

[env:eel_esp32s3_touch]
extends = arduino_base, esp32_base, radiolib_base, device-ui_base
board = eel_esp32s3_touch

board_build.partitions = default_16MB.csv
board_build.psram_type = opi
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_upload.flash_size = 16MB

build_unflags =
    -flto

upload_protocol = esptool
monitor_speed = 115200
upload_port = /dev/ttyACM0
upload_flags =
    --before
    no_reset

build_flags =
    ${esp32_base.build_flags}
    -I variants/eel_esp32s3_touch
    -mfix-esp32-psram-cache-issue
    -I .pio/libdeps/eel_esp32s3_touch/lvgl
    -I .pio/libdeps/eel_esp32s3_touch/meshtastic-device-ui/generated/ui_320x240/

    ; Board identification
    -D HW_VENDOR=meshtastic_HardwareModel_PRIVATE_HW
    -D EEL_ESP32S3_TOUCH

    ; USB CDC
    -D ARDUINO_USB_CDC_ON_BOOT=1

    ; Display configuration for LVGL with LovyanGFX
    -D HAS_TOUCHSCREEN=0
    -D LV_LVGL_H_INCLUDE_SIMPLE
    -D LV_CONF_INCLUDE_SIMPLE
    -D LV_USE_TICK_MEASURE=1

    ; LGFX specific flags
    -D LGFX_DRIVER_TEMPLATE
    -D LGFX_DRIVER=LGFX_GENERIC
    -D LGFX_PANEL=ST7789
    -D LGFX_PIN_SCK=2
    -D LGFX_PIN_MOSI=3
    -D LGFX_PIN_MISO=4
    -D LGFX_PIN_DC=1
    -D LGFX_PIN_CS=16
    -D LGFX_PIN_RST=12
    -D LGFX_PIN_BL=15
    -D LGFX_SCREEN_WIDTH=320
    -D LGFX_SCREEN_HEIGHT=240
    -D LGFX_ROTATION=1
    -D LGFX_INVERT_COLOR=true
    -D TFT_BACKLIGHT_ON=HIGH
    -D SPI_FREQUENCY=40000000
    -D SPI_READ_FREQUENCY=16000000

    ; Disable I2C initialization
    -D WIRE_HAS_OVERRIDE_I2C=0


    ; Radio
    -D USE_SX1262
    -D SX126X_DIO3_TCXO_VOLTAGE=1.8

    ; Exclusions
    -D MESHTASTIC_EXCLUDE_WIFI=1
    -D MESHTASTIC_EXCLUDE_WEBSERVER=1
    -D MESHTASTIC_EXCLUDE_MQTT=1
    -D MESHTASTIC_EXCLUDE_ENVIRONMENTAL_SENSOR=1
    -D MESHTASTIC_EXCLUDE_POWER_TELEMETRY=1
    -D MESHTASTIC_EXCLUDE_AUDIO=1
    -D MESHTASTIC_EXCLUDE_REMOTE_HARDWARE=1
    -D MESHTASTIC_EXCLUDE_GPS=1
    -D MESHTASTIC_EXCLUDE_DISPLAY_DEBUG=1
    -D MESHTASTIC_EXCLUDE_RTTTL=1
    -D MESHTASTIC_EXCLUDE_SDCARD=1
    -D NO_USB_SERIAL=1
    -D MESHTASTIC_EXCLUDE_BLUETOOTH=1

    ; Other
    -D NEOPIXEL_DATA=13
    -D BUTTON_PIN=18
    -D RAM_SIZE=5120

lib_ignore =
    Wire

lib_deps =
    ${arduino_base.lib_deps}
    ${esp32_base.lib_deps}
    ${radiolib_base.lib_deps}
    ${device-ui_base.lib_deps}
    lovyan03/LovyanGFX@^1.1.16

build_src_filter =
    ${esp32s3_base.build_src_filter}
