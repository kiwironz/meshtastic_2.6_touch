; ===========================================
; EEL ESP32-S3 Touch Board Configuration for Meshtastic 2.6.11
; ===========================================

[env:eel_esp32s3_touch]
; extends = arduino_base, esp32_base, radiolib_base, device-ui_base
; extends = esp32s3_base, device-ui_base
extends = esp32s3_base
board = eel_esp32s3_touch

board_build.partitions = default_16MB.csv
board_build.psram_type = opi
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_upload.flash_size = 16MB

build_unflags =
    -flto

upload_protocol = esptool
upload_speed = 921600
monitor_speed = 115200
upload_port = /dev/ttyACM0
upload_flags =
    --before
    no_reset

build_flags =
    ${esp32_base.build_flags}
    -I variants/eel_esp32s3_touch
    -mfix-esp32-psram-cache-issue
    ; -I .pio/libdeps/eel_esp32s3_touch/lvgl
    ; -I .pio/libdeps/eel_esp32s3_touch/meshtastic-device-ui/generated/ui_320x240/
    ; Explicitly add framework core library paths
    ; -I $PROJECT_PACKAGES_DIR/framework-arduinoespressif32/libraries



    ; Board identification
    -D HW_VENDOR=meshtastic_HardwareModel_PRIVATE_HW
    -D EEL_ESP32S3_TOUCH

    ; Display configuration for LVGL with LovyanGFX
    ; -D HAS_TOUCHSCREEN=0
    ; -D HAS_TFT=1
    ; -D HAS_SCREEN=0
    ; -D USE_PACKET_API
    ; -D LV_LVGL_H_INCLUDE_SIMPLE
    ; -D LV_CONF_INCLUDE_SIMPLE
    ; -D LV_COMP_CONF_INCLUDE_SIMPLE
    ; -D LV_USE_SYSMON=0
    ; -D LV_USE_PROFILER=0
    ; -D LV_USE_PERF_MONITOR=0
    ; -D LV_USE_MEM_MONITOR=0
    ; -D LV_USE_LOG=0
    ; -D LV_BUILD_TEST=0
    ; -D VIEW_320x240
    ; -D CONFIG_DISABLE_HAL_LOCKS=1
    ; -D LV_FS_ARDUINO_ESP_LITTLEFS_PATH=""
    ; -D CONFIG_LV_FS_ARDUINO_ESP_LITTLEFS_PATH=""


    ; LGFX specific flags
    ; -D LGFX_DRIVER_TEMPLATE
    ; -D LGFX_DRIVER=LGFX_GENERIC
    ; -D LGFX_PANEL=ST7789
    ; -D LGFX_PIN_SCK=2
    ; -D LGFX_PIN_MOSI=3
    ; -D LGFX_PIN_MISO=4
    ; -D LGFX_PIN_DC=1
    ; -D LGFX_PIN_CS=16
    ; -D LGFX_PIN_RST=12
    ; -D LGFX_PIN_BL=15
    ; -D LGFX_SCREEN_WIDTH=320    
    ; -D LGFX_SCREEN_HEIGHT=240
    ; -D LGFX_ROTATION=1
    ; -D LGFX_INVERT_COLOR=true
    ; -D TFT_BACKLIGHT_ON=HIGH
    ; -D SPI_FREQUENCY=40000000
    ; -D SPI_READ_FREQUENCY=16000000

    ; Disable I2C initialization
    ; -D WIRE_HAS_OVERRIDE_I2C=0


    -D HAS_WIFI=1                     ; Enable WiFi for OTA and web server
    -D HAS_BLUETOOTH=1                ; Enable Bluetooth
    -D HAS_RADIO=1                    ; Enable LoRa radio
; Temporarily remove all display support
    -D HAS_TOUCHSCREEN=0
    -D HAS_TFT=0
    -D HAS_LGFX=0
    -D HAS_LVGL=0
    -D HAS_SCREEN=0
    -D MESHTASTIC_EXCLUDE_SCREEN      ; No display support
    ; -D USE_PACKET_API
; -------------------------------------------
    ; Radio
    -D USE_SX1262
    -D SX126X_DIO3_TCXO_VOLTAGE=1.8

    ; Exclusions
    -D MESHTASTIC_EXCLUDE_WIFI=1
    -D MESHTASTIC_EXCLUDE_WEBSERVER=1
    -D MESHTASTIC_EXCLUDE_MQTT=1
    ; I2C is not physically present on this board — exclude I2C at build time so
    ; modules and drivers that use Wire are not compiled/instantiated.
    -D MESHTASTIC_EXCLUDE_I2C=1
        ; We don't use environmental sensors on this variant — disable at build-time so
        ; headers that expect sensor types won't be inconsistently declared.
    -D MESHTASTIC_EXCLUDE_ENVIRONMENTAL_SENSOR=1
    -D MESHTASTIC_EXCLUDE_POWER_TELEMETRY=1
    -D MESHTASTIC_EXCLUDE_DEVICE_METRICS=1
    -D MESHTASTIC_EXCLUDE_INPUTBROKER=1
    -D MESHTASTIC_EXCLUDE_AUDIO=1
    -D MESHTASTIC_EXCLUDE_REMOTE_HARDWARE=1
    -D MESHTASTIC_EXCLUDE_EXTERNALNOTIFICATION=1
    -D MESHTASTIC_EXCLUDE_POWER_FSM=1
    -D MESHTASTIC_EXCLUDE_GPS=1
    -D MESHTASTIC_EXCLUDE_DISPLAY_DEBUG=1
    -D MESHTASTIC_EXCLUDE_RTTTL=1
    -D MESHTASTIC_EXCLUDE_SDCARD=1
    -D NO_USB_SERIAL=1
    -D MESHTASTIC_EXCLUDE_BLUETOOTH=1
    ; -D MESHTASTIC_EXCLUDE_I2C_SCAN=1
        ; I2C pins are marked as unavailable in the variant header (I2C_SDA/I2C_SCL = -1)
        ; Do not globally exclude I2C here because some headers use __has_include() and
        ; expect sensor classes to be defined when supporting libraries are present.

    ; Other
    -D NEOPIXEL_DATA=13
    -D BUTTON_PIN=18
    -D RAM_SIZE=5120
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D BOARD_HAS_PSRAM                ; ESP32-S3 has PSRAM



; lib_ignore =
;     Wire
;     SPI

; Temporarily remove all display support
; lib_ignore =
;     meshtastic-device-ui
;     LovyanGFX
; -------------------------------------------

lib_deps =
    ${esp32_base.lib_deps}
    ; ${device-ui_base.lib_deps}
    ; lovyan03/LovyanGFX@^1.1.16


build_src_filter =
    ${esp32s3_base.build_src_filter}